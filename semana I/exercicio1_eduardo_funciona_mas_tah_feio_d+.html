<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-Type" content="text/html; charset=UTF-8">
  <title>Javascript - Exercício 1</title>
</head>

<body>

<h1>Javascript  - Exercício 1</h1>

<p>
  Abra este arquivo html, edite e implemente a função <strong>toJSON</strong>.
  A função deve receber um objeto e retornar uma string contentdo um JSON a partir
  dele. Devem ser impressas todas as propriedades to objeto, ignorando as
  propriedades do protótipo e as funções. Você pode validar o JSON gerado no
  <a href="http://jsonlint.com/" target="_blank">JsonLint</a>.
</p>
<p>
  Dicas: hasOwnProperty, typeof
</p>

<section id="results"></section>

</body>

<script>

  // Implemente esta função:

  function toJSON(obj, stringJson ) {

    var name;
    
    if ( !Array.isArray( obj ) ) {

      stringJson += "{";

      for ( name in obj ) {

        if ( obj[name] !== null && typeof obj[name] !== 'function' ) {

          if ( !Array.isArray( obj[name] ) ) {            
            
            if( typeof obj[name] === "object" ) {            
              
              stringJson += "\"" +  name + "\"" + ":{";

              var propriedade;
              for ( propriedade in obj[name] ) {
                
                if ( !Array.isArray( propriedade ) ) {

                  if ( typeof propriedade === "object" ) {                  
                    toJSON( propriedade, stringJson );
                  } else {

                    if( typeof obj[name][propriedade] === "string") {
                      stringJson += "\"" +  propriedade + "\"" + ":" + "\""+ obj[name][propriedade] + "\"";  
                    }else {
                      stringJson += "\"" +  propriedade + "\"" + ":" + obj[name][propriedade];  
                    }

                    if (!inserirVirgula( obj[name], obj[name][propriedade], stringJson) ) {
                      stringJson += ",";
                    }                    
                  }
                } else {
                  toJSON( propriedade, stringJson );
                }
              }

              stringJson += "}";

            } else {

              if( typeof obj[name] === "string") {
                stringJson += "\"" + name + "\"" + ":" + "\"" + obj[name] + "\"";              
              }else {
                stringJson += "\"" + name + "\"" + ":" + obj[name];              
              }              
            }
          }
          else {

            stringJson += "\"" + name + "\"" + ":";
            stringJson = toJSON( obj[name], stringJson );
          }          
        } else {

          if ( obj[name] === null || obj[name] === undefined && typeof obj[name] !== 'function' ) {
            stringJson += "\"" + name + "\"" + ":" + null;
          }
        }
       if ( ( !inserirVirgula(obj, obj[name], stringJson) ) && ( typeof obj[name] !== 'function' ) ) {
            stringJson += ",";
         }
      }

      stringJson += "}";  

    } else {
      stringJson += "[";

      for (var i = 0; i < obj.length; i++) {
        
        if( Array.isArray( obj[i] ) || typeof obj[i] === "object" ) {

          if ( obj[i] === null ) {
            stringJson += "null";
          } else {
            stringJson = toJSON( obj[i], stringJson );
          }

        } else {      

          if ( obj[i] === undefined ) {
            stringJson += "null";
          } else {
            if( typeof obj[i] === "string") {
              stringJson += "\"" + obj[i] + "\"";              
            }else {
              stringJson += obj[i];              
            }  
          };                     
        }
        if( ( !inserirVirgula( obj, obj[i], stringJson ) ) && ( obj[name] !== 'function' )  ) {
          stringJson += ",";
        }
      };

      stringJson += "]";
    }
    return stringJson;
  }

  function inserirVirgula( obj, property, stringJson ) {
    return obj[Object.keys(obj)[Object.keys(obj).length - 1]] === property;      
  }

  // Objetos para teste. Altere / adicione caso necessário.

  var tests = []

  
  tests[0] = {
    id: 13,
    name: "Fernando Simeone",
    role: {
      id: 5,
      name: "Desenvolvedor"
    }
  };

  tests[1] = [1, { id: 3}, true];

  tests[2] = [1,null, undefined, { variavel: tests[1] }];
  
  tests[3] = {
      id: 1,
      name: null,
      save: function () { alert("save"); return 0; },
      roles: [
        {id: 1, },
        {id: 2, children: [ {id: 3, id: 4} ] }
      ],
      parents: [],
      money: 45.70,
      testes1: [
        { teste1: tests[0] },
        { teste2: tests[1] },
        { teste3: tests[2] },
        { teste4: {
          objeto : {
            id: 100,
            name: "Teste",
            roles: [
              {id: 1, },
              {id: 2, children: [ {id: 3, id: 4}, tests[0] ] }
            ]
          }
        }}
      ]
    };


  // O código abaixo é utilizado para a execução automática dos testes. Não modifique.

  (function (tests) {

    var html = "", i = 0;

    for (i = 0; i < tests.length; i++)
      html += "<h2>Teste " + i+ "</h2><p>" +
                    "<strong>Resultado:</strong></p><p>" + toJSON(tests[i], "") + "</p>" +
                    "<p><strong>Resultado esperado:</strong></p>" + JSON.stringify(tests[i]) ;

    document.getElementById("results").innerHTML = html;
  })(tests);

</script>

</html>
